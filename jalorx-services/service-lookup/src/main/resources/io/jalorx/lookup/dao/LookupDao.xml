<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" 
	"http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="io.jalorx.lookup.dao.LookupDao">

	<!-- <cache /> -->

	<!-- ///////////////////////////基础接口定义///////////////////////////////// -->

	<select id="getById" resultType="io.jalorx.lookup.entity.Lookup">
		SELECT
		T.*
		FROM TPL_LOOKUP_T T
		WHERE T.ID = #{id}
	</select>

	<select id="getCount" resultType="int">
		SELECT
		count(1)
		FROM TPL_LOOKUP_T T
		<filter open="where (" close=")" />
	</select>

	<select id="selectAll" resultType="io.jalorx.lookup.entity.Lookup">
		SELECT
		T.*
		FROM TPL_LOOKUP_T T
		<filter open="where (" close=")" />
		ORDER BY T.ID DESC
	</select>

	<select id="selectTreeById" resultType="io.jalorx.lookup.entity.Lookup">
		SELECT
		T.*
		FROM TPL_LOOKUP_T T
		start with T.ID = #{id} CONNECT BY PRIOR ID =
		PARENT_ID
	</select>

	<select id="asyncCascaderSelectAll" resultType="io.jalorx.lookup.entity.Lookup">
		SELECT T.* , CASE WHEN CNNUM IS NULL THEN 1 ELSE 0 END AS IS_LEAF FROM TPL_LOOKUP_T T
		LEFT JOIN
		(SELECT COUNT(1) AS CNNUM , PARENT_ID FROM TPL_LOOKUP_T GROUP BY PARENT_ID ) T2 ON T.ID = T2.PARENT_ID
		<filter open="where (" close=")" />
	</select>

	<select id="select" resultType="io.jalorx.lookup.entity.Lookup" pageable='true'>
		SELECT T.* FROM TPL_LOOKUP_T T
		<filter open="where (" close=")" name="T" value="query" />
		ORDER BY T.ID DESC
	</select>

	<!-- 插入语句 -->
	<sql id="base_insert_sql">
		INSERT INTO TPL_LOOKUP_T
		(<if test="id != null">ID,</if>CODE, DESP, TYPE, PARENT_ID, GROUP_CODE,
		TENANT_ID,APP_NAME,APP_SCOPE,
		REVISION, CREATE_USER_ID, CREATE_DATE ,LAST_UPDATE_USER_ID, LAST_UPDATE_DATE)
		VALUES
		(<if test="id != null">#{id,jdbcType=NUMERIC},</if>#{code,jdbcType=VARCHAR},#{desp,jdbcType=VARCHAR},#{type,jdbcType=VARCHAR},#{parentId,jdbcType=INTEGER},#{groupCode,jdbcType=VARCHAR},
		#{tenantId,jdbcType=VARCHAR},#{appName,jdbcType=VARCHAR},#{appScope,jdbcType=VARCHAR},
		#{revision,jdbcType=NUMERIC},#{currentUserId,jdbcType=VARCHAR},#{_currentDate},#{currentUserId,jdbcType=VARCHAR},#{_currentDate})
	</sql>

	<insert id="insert" parameterType="io.jalorx.lookup.entity.Lookup" useGeneratedKeys="true" keyColumn="ID" keyProperty="id">
		<selectKey resultType="long" keyProperty="id" order="BEFORE" databaseId="oracle">
			SELECT TPL_LOOKUP_S.NEXTVAL AS value FROM dual
		</selectKey>
		<include refid="base_insert_sql" />
	</insert>

	<update id="update" parameterType="io.jalorx.lookup.entity.Lookup">
		UPDATE tpl_lookup_t SET
		CODE = #{code,jdbcType=VARCHAR},
		DESP = #{desp,jdbcType=VARCHAR},
		TYPE = #{type,jdbcType=VARCHAR},
		REVISION = #{revisionNext,jdbcType=NUMERIC},
		LAST_UPDATE_USER_ID = #{currentUserId,jdbcType=VARCHAR},
		LAST_UPDATE_DATE = #{_currentDate}
		WHERE ID = #{id,jdbcType=NUMERIC}
	</update>


	<delete id="deleteById">
		DELETE FROM tpl_lookup_t
		WHERE ID = #{id}
	</delete>
	<delete id="deleteByIds">
		DELETE FROM tpl_lookup_t
		WHERE ID in
		<foreach collection="ids" item="id" open="(" separator="," close=")">
		#{id}
		</foreach>
	</delete>

	<select id="lookupByParentId" resultType="io.jalorx.lookup.entity.Lookup">
		SELECT T.* , CASE WHEN CNNUM IS NULL THEN 1 ELSE 0 END AS IS_LEAF FROM TPL_LOOKUP_T T
		LEFT JOIN
		(SELECT COUNT(1) AS CNNUM , PARENT_ID FROM TPL_LOOKUP_T GROUP BY PARENT_ID ) T2 ON T.ID = T2.PARENT_ID
		WHERE T.PARENT_ID =
		#{parentId}
		ORDER BY T.ID DESC
	</select>

	<select id="lookupByGroupCode" resultType="io.jalorx.lookup.entity.Lookup">
		SELECT T.* , CASE WHEN CNNUM IS NULL THEN 1 ELSE 0 END AS IS_LEAF FROM
		TPL_LOOKUP_T T
		LEFT JOIN
		(SELECT COUNT(1) AS CNNUM , PARENT_ID FROM TPL_LOOKUP_T GROUP BY PARENT_ID ) T2 ON T.ID = T2.PARENT_ID
		WHERE T.PARENT_ID != 0 AND GROUP_CODE = #{groupCode}
	</select>

	<select id="getLookupByCode" resultType="io.jalorx.lookup.entity.Lookup">
		SELECT T.* FROM TPL_LOOKUP_T T WHERE T.CODE = #{code} AND T.GROUP_CODE =
		#{groupCode}
	</select>
	 
	 <select id="getLookupByCodes" resultType="io.jalorx.lookup.entity.Lookup">
		SELECT T.* FROM TPL_LOOKUP_T T WHERE T.CODE IN 
		<foreach collection="codes" open="(" close=")" item="code" separator="," >
			#{code}
		</foreach>
		  AND T.GROUP_CODE = #{groupCode}
	 </select>
	<!-- //////////////////////////////////////////////////////////// -->

</mapper>

